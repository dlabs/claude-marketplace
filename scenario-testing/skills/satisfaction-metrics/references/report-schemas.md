# Report and Data Schemas

JSON schemas for all data files generated by the scenario-testing plugin.

## Run Manifest Schema

Created at `.scenarios/runs/{date}-{seq}/run-manifest.json`:

```json
{
  "$schema": "run-manifest",
  "version": 1,
  "run_id": "2026-02-20-001",
  "started_at": "2026-02-20T14:30:00Z",
  "completed_at": "2026-02-20T14:45:00Z",
  "config": {
    "trajectories_per_scenario": 50,
    "chaos_profile": "moderate",
    "twins_active": ["okta", "jira", "slack"],
    "domains_included": ["auth", "integrations"],
    "scenarios_included": ["sso-login", "slack-to-jira"],
    "judge_model": "opus",
    "judge_temperature": 0.0
  },
  "summary": {
    "total_scenarios": 2,
    "total_trajectories": 100,
    "total_judgments": 100,
    "satisfactory": 91,
    "unsatisfactory": 9,
    "overall_satisfaction": 0.91
  },
  "scenarios": {
    "sso-login": {
      "domain": "auth",
      "version": 2,
      "trajectories": 50,
      "satisfactory": 48,
      "satisfaction": 0.96
    },
    "slack-to-jira": {
      "domain": "integrations",
      "version": 1,
      "trajectories": 50,
      "satisfactory": 43,
      "satisfaction": 0.86
    }
  }
}
```

## Trajectory Schema

Created at `.scenarios/runs/{run-id}/trajectories/{scenario}-{n}.json`:

```json
{
  "$schema": "trajectory",
  "version": 1,
  "trajectory_id": "sso-login-001",
  "scenario_id": "sso-login",
  "scenario_version": 2,
  "run_id": "2026-02-20-001",
  "started_at": "2026-02-20T14:30:01Z",
  "completed_at": "2026-02-20T14:30:04Z",
  "duration_ms": 3200,
  "chaos_injected": [
    {
      "type": "latency",
      "target": "okta",
      "delay_ms": 450,
      "request": "POST /api/v1/authn"
    }
  ],
  "events": [
    {
      "seq": 1,
      "timestamp": "2026-02-20T14:30:01.100Z",
      "type": "user_action",
      "description": "Click 'Sign in with SSO'",
      "state_before": { "authenticated": false }
    },
    {
      "seq": 2,
      "timestamp": "2026-02-20T14:30:01.200Z",
      "type": "api_call",
      "service": "okta",
      "method": "POST",
      "path": "/api/v1/authn",
      "request_summary": "Primary authentication with username/password",
      "response_code": 200,
      "response_summary": "Authentication successful, session token returned",
      "duration_ms": 550
    },
    {
      "seq": 3,
      "timestamp": "2026-02-20T14:30:01.800Z",
      "type": "state_transition",
      "entity": "auth_session",
      "from": "unauthenticated",
      "to": "authenticated"
    },
    {
      "seq": 4,
      "timestamp": "2026-02-20T14:30:02.000Z",
      "type": "api_call",
      "service": "okta",
      "method": "POST",
      "path": "/oauth2/v1/token",
      "request_summary": "Exchange session token for OAuth access token",
      "response_code": 200,
      "response_summary": "Access token issued, expires in 3600s",
      "duration_ms": 200
    },
    {
      "seq": 5,
      "timestamp": "2026-02-20T14:30:02.500Z",
      "type": "system_event",
      "description": "User redirected to dashboard",
      "state_after": { "authenticated": true, "page": "dashboard" }
    }
  ],
  "final_state": {
    "authenticated": true,
    "user_visible": "Dashboard with user name and role displayed",
    "session_valid": true
  },
  "outcome_summary": "User successfully authenticated via SSO and was redirected to dashboard in 2.5 seconds"
}
```

## Judgment Schema

Created at `.scenarios/runs/{run-id}/judgments/{scenario}-{n}.json`:

```json
{
  "$schema": "judgment",
  "version": 1,
  "trajectory_id": "sso-login-001",
  "scenario_id": "sso-login",
  "run_id": "2026-02-20-001",
  "judged_at": "2026-02-20T14:46:00Z",
  "judge_config": {
    "model": "opus",
    "temperature": 0.0,
    "prompt_version": "default-v1"
  },
  "verdict": "satisfactory",
  "reasoning": "User was authenticated via SSO and redirected to their dashboard within 2.5 seconds. Dashboard displayed the correct user name and role. Session persisted correctly.",
  "criteria_matched": [
    "User is logged in and sees their dashboard within 5 seconds",
    "User's name and role are displayed correctly",
    "Session persists across page refreshes"
  ],
  "anti_patterns_matched": [],
  "confidence": 0.95
}
```

## Satisfaction Report Schema

Created at `.scenarios/reports/latest.json` and `.scenarios/reports/history/{date}.json`:

```json
{
  "$schema": "satisfaction-report",
  "version": 1,
  "generated_at": "2026-02-20T15:00:00Z",
  "run_id": "2026-02-20-001",
  "overall": {
    "satisfaction": 0.91,
    "total_trajectories": 100,
    "satisfactory": 91,
    "pass": true,
    "threshold": 0.80
  },
  "domains": {
    "auth": {
      "satisfaction": 0.96,
      "trajectories": 50,
      "satisfactory": 48,
      "threshold": 0.95,
      "pass": true,
      "scenarios": {
        "sso-login": {
          "satisfaction": 0.96,
          "trajectories": 50,
          "satisfactory": 48,
          "version": 2,
          "threshold": 0.98,
          "pass": false
        }
      }
    },
    "integrations": {
      "satisfaction": 0.86,
      "trajectories": 50,
      "satisfactory": 43,
      "threshold": 0.85,
      "pass": true,
      "scenarios": {
        "slack-to-jira": {
          "satisfaction": 0.86,
          "trajectories": 50,
          "satisfactory": 43,
          "version": 1,
          "threshold": null,
          "pass": true
        }
      }
    }
  },
  "failing_scenarios": [
    {
      "id": "sso-login",
      "domain": "auth",
      "satisfaction": 0.96,
      "threshold": 0.98,
      "failure_summary": "2 trajectories had slow Okta response (>3s) causing login timeout",
      "common_anti_patterns": [],
      "common_unmet_criteria": ["User is logged in and sees their dashboard within 5 seconds"]
    }
  ],
  "comparison": {
    "previous_run_id": "2026-02-19-001",
    "previous_date": "2026-02-19",
    "overall_delta": "+0.02",
    "improvements": [
      { "scenario": "slack-to-jira", "from": 0.82, "to": 0.86, "delta": "+0.04" }
    ],
    "regressions": [],
    "stable": [
      { "scenario": "sso-login", "from": 0.96, "to": 0.96, "delta": "0.00" }
    ]
  }
}
```

## Catalog Index Schema

At `.scenarios/catalog.json`:

```json
{
  "$schema": "catalog",
  "version": 1,
  "updated_at": "2026-02-20T15:00:00Z",
  "domains": {
    "auth": {
      "scenarios": [
        { "id": "sso-login", "version": 2, "path": "catalog/auth/sso-login.scenario.yaml" },
        { "id": "password-reset", "version": 1, "path": "catalog/auth/password-reset.scenario.yaml" }
      ]
    },
    "integrations": {
      "scenarios": [
        { "id": "slack-to-jira", "version": 1, "path": "catalog/integrations/slack-to-jira.scenario.yaml" }
      ]
    }
  },
  "twins": [
    { "name": "okta", "version": 1, "path": "twins/okta/" },
    { "name": "jira", "version": 1, "path": "twins/jira/" },
    { "name": "slack", "version": 1, "path": "twins/slack/" }
  ],
  "stats": {
    "total_scenarios": 3,
    "total_twins": 3,
    "total_domains": 2,
    "last_run": "2026-02-20-001",
    "last_satisfaction": 0.91
  }
}
```

## Config Schema

At `.scenarios/config.json`:

```json
{
  "$schema": "scenario-config",
  "version": 1,
  "storage": "holdout",
  "thresholds": {
    "global_minimum": 0.80,
    "domains": {},
    "scenarios": {}
  },
  "defaults": {
    "trajectories_per_scenario": 50,
    "judge_model": "opus",
    "judge_temperature": 0.0,
    "chaos_profile": "gentle"
  },
  "judge_overrides": {},
  "twin_port_start": 9001,
  "report_format": "terminal"
}
```
